(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function st(e){const t=e.trim().split(`
`),n=[];let o=0;console.log(`Parsing CSV with ${t.length} lines`);for(let s=1;s<t.length;s++){const a=t[s];if(!a.trim()){o++;continue}const l=at(a);if(l.length>=7){const f=l[1].replace(/"/g,"").trim(),r=l[4].replace(/"/g,"").trim(),i=l[5].replace(/"/g,"").trim(),d=l[6].replace(/"/g,"").trim();if(!f||!r){console.warn(`Line ${s+1}: Missing date or description`),o++;continue}let c=0;if(i){const u=parseFloat(i);!isNaN(u)&&u!==0&&(c=-Math.abs(u))}else if(d){const u=parseFloat(d);!isNaN(u)&&u!==0&&(c=Math.abs(u))}if(c===0){console.warn(`Line ${s+1}: No valid amount - debit: "${i}", credit: "${d}"`),o++;continue}n.push({date:f,description:r,amount:c})}else console.warn(`Line ${s+1}: Only ${l.length} columns, expected at least 7`),o++}return console.log(`Parsed ${n.length} valid transactions, skipped ${o} lines`),n}function at(e){const t=[];let n="",o=!1;for(let s=0;s<e.length;s++){const a=e[s];a==='"'?(o=!o,n+=a):a===","&&!o?(t.push(n),n=""):n+=a}return t.push(n),t}const rt={Rent:["TRAILS","APARTMENT","PROPERTY","RENT","RPS"],Utilities:["ELECTRIC","WATER","INTERNET","GAS","UTILITY","GALLATINELECTRC","ATT BILL","AT&T"],Food:["KROGER","WALMART","CHICK","MCDONALD","RESTAURANT","CAFE","GROCERY","PUBLIX","TARGET","PAPA JOHN","CULVER","WENDY","CRACKER BARREL","PANERA","KEKES","WHATABURGER","WAFFLE HOUSE","ALDI","INSTACART","CHINA BUFFET","ROUXS CREOLE","STORMING CRAB","FLAVORS OF INDIA","BEST DONUTS","DONUT"],Subscriptions:["OPENAI","NETFLIX","SPOTIFY","SUBSCRIPTION","MEMBERSHIP","BOLT","MICROSOFT","APPLE.COM/BILL","NETWORKSOLU","APPLE"],Transfers:["VENMO","ZELLE","TRANSFER","XFER","SCHWAB BROKERAGE","EB TO SAVINGS","ATM WITHDRAWAL"],Income:["EB FROM CHECKING","PAYROLL","DEPOSIT","SALARY","EARNINGS","MONTGOMERY ENGIN","IRS TREAS","TAX REFUND"],"Auto & Gas":["RACETRAC","SHELL","MARATHON","MURPHY","KROGER FUEL","MISTER CAR WASH","BJ S AUTO"],Shopping:["AMAZON","LOWE","SALLY BEAUTY","CSC SERVICE"],Entertainment:["REG INDIAN LAKE","FANDANGO"],Charity:["GIV*FIRST CUMBER"]};function it(e){return Array.isArray(e)?e.filter(t=>t?t.description?typeof t.amount>"u"?(console.warn("Transaction missing amount:",t),!1):!0:(console.warn("Transaction missing description:",t),!1):(console.warn("Null transaction found"),!1)).map(t=>({transaction:t,category:ct(t)})):(console.error("categorizeTransactions received non-array:",e),[])}function ct(e){if(!e||!e.description)return"Uncategorized";const t=e.description.toUpperCase();for(const[n,o]of Object.entries(rt))for(const s of o)if(t.includes(s.toUpperCase()))return n;return"Uncategorized"}function k(e){let t=0,n=0;const o={};let s=null;console.log("Aggregating data for",e.length,"items"),e.forEach((f,r)=>{if(!f){console.warn(`Item ${r} is null/undefined`);return}const{transaction:i,category:d}=f;if(!i){console.warn(`Item ${r} has no transaction:`,f);return}if(typeof i.amount>"u"){console.warn(`Item ${r} transaction has no amount:`,i);return}const c=i.amount;if(c>0?t+=c:n+=Math.abs(c),o[d]||(o[d]=0),o[d]+=Math.abs(c),c<0){const u=Math.abs(c);(!s||u>s.amount)&&(s={description:i.description,amount:u})}});const a=t-n,l=Object.entries(o).sort((f,r)=>r[1]-f[1]);return{totalIncome:t,totalExpenses:n,netChange:a,categoryTotals:l,largestExpense:s,transactionCount:e.length}}function lt(e){const t={};return e.forEach(o=>{if(!o||!o.transaction||!o.transaction.date)return;const s=o.transaction.date.split("/");if(s.length<3)return;const[a,l,f]=s,r=`${f}-${a.padStart(2,"0")}`;t[r]||(t[r]=[]),t[r].push(o)}),Object.keys(t).sort().map(o=>{const s=t[o];return{month:o,transactions:s.map(a=>({...a.transaction,category:a.category})),summary:k(s)}})}function Y(e,t){document.getElementById("total-income").textContent=y(e.totalIncome),document.getElementById("total-expenses").textContent=y(e.totalExpenses);const n=document.getElementById("net-change");n.textContent=y(e.netChange),n.parentElement.classList.remove("positive","negative"),n.parentElement.classList.add(e.netChange>=0?"positive":"negative"),K(e.categoryTotals),W(e.categoryTotals),ut(t)}function dt(e){if(document.getElementById("report-container"),e.length===1){const{summary:r,transactions:i}=e[0];Y(r,i);return}let t=0,n=0,o={};e.forEach(({summary:r})=>{t+=r.totalIncome,n+=r.totalExpenses,r.categoryTotals.forEach(([i,d])=>{o[i]=(o[i]||0)+d})});const s=t-n,a=Object.entries(o).sort((r,i)=>i[1]-r[1]);document.getElementById("total-income").textContent=y(t),document.getElementById("total-expenses").textContent=y(n);const l=document.getElementById("net-change");l.textContent=y(s),l.parentElement.classList.remove("positive","negative"),l.parentElement.classList.add(s>=0?"positive":"negative"),K(a),gt(a),W(a);const f=document.getElementById("transactions-body");f.innerHTML=e.map(({month:r,transactions:i,summary:d})=>`
        <tr class="month-separator">
            <td colspan="4" style="background: var(--color-bg-secondary); padding: 1rem; font-weight: 600; color: var(--color-primary);">
                ${X(r)} - ${y(d.netChange)} net change (${i.length} transactions)
            </td>
        </tr>
        ${i.filter(c=>c&&c.transaction&&typeof c.transaction.amount<"u").map(c=>{const u=c.transaction.amount<0,g=u?"negative":"positive",p=u?"-":"+",h=Math.abs(c.transaction.amount);return`
                <tr>
                    <td>${c.transaction.date}</td>
                    <td class="description">${c.transaction.description}</td>
                    <td><span class="category-badge ${_(c.category)}">${c.category}</span></td>
                    <td class="text-right ${g}">${p}$${h.toFixed(2)}</td>
                </tr>
            `}).join("")}
    `).join("")}function K(e){const t=document.getElementById("category-chart"),n=e[0]?.[1]||1;t.innerHTML=e.map(([o,s])=>{const a=s/n*100;return`
            <div class="category-row">
                <div class="category-info">
                    <span class="category-name">${o}</span>
                    <span class="category-amount">${y(s)}</span>
                </div>
                <div class="category-bar-container">
                    <div class="category-bar" style="width: ${a}%"></div>
                </div>
            </div>
        `}).join("")}function W(e){const t=document.getElementById("category-filter"),n=t.value;t.innerHTML='<option value="">All Categories</option>'+e.map(([o])=>`<option value="${o}">${o}</option>`).join(""),n&&(t.value=n)}function ut(e){const t=document.getElementById("transactions-body");t.innerHTML=e.filter(n=>n&&n.transaction&&typeof n.transaction.amount<"u").map(n=>{const o=n.transaction.amount<0,s=o?"negative":"positive",a=o?"-":"+",l=Math.abs(n.transaction.amount);return`
            <tr>
                <td>${n.transaction.date}</td>
                <td class="description">${n.transaction.description}</td>
                <td><span class="category-badge ${_(n.category)}">${n.category}</span></td>
                <td class="text-right ${s}">${a}$${l.toFixed(2)}</td>
            </tr>
        `}).join("")}function _(e){return{Income:"cat-income",Rent:"cat-rent",Food:"cat-food",Utilities:"cat-utilities","Auto & Gas":"cat-auto",Subscriptions:"cat-subscriptions",Transfers:"cat-transfers",Shopping:"cat-shopping",Entertainment:"cat-entertainment",Charity:"cat-charity",Uncategorized:"cat-uncategorized"}[e]||"cat-default"}function y(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e)}function X(e){const[t,n]=e.split("-");return new Date(t,parseInt(n)-1).toLocaleDateString("en-US",{year:"numeric",month:"long"})}function H(e){const t=document.getElementById("insights-section");if(!e||e.length===0){t.innerHTML="";return}const n={warning:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>',trend:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>',tip:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>',recurring:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>'};t.innerHTML=`
        <div class="insights-grid">
            ${e.map(o=>`
                <div class="insight-card ${o.insight_type}">
                    <div class="insight-header">
                        <span class="insight-icon">${n[o.insight_type]||n.tip}</span>
                        <span class="insight-type">${o.insight_type}</span>
                    </div>
                    <div class="insight-message">${o.message}</div>
                </div>
            `).join("")}
        </div>
    `}function N(e,t,n){const o=document.getElementById("budgets-list");if(!e||e.length===0){o.innerHTML='<p style="color: var(--color-text-secondary); text-align: center; padding: 1rem;">No budgets set. Click + to add one.</p>';return}const s=Object.fromEntries(t);o.innerHTML=e.map(a=>{const l=Math.abs(s[a.category]||0),f=parseFloat(a.amount),r=Math.min(l/f*100,100);let i="";return r>=100?i="danger":r>=80&&(i="warning"),`
            <div class="budget-item">
                <div class="budget-header">
                    <span class="budget-category">${a.category}</span>
                    <button class="btn-small btn-delete" onclick="deleteBudgetItem('${a.category}')">Delete</button>
                </div>
                <div class="budget-amounts">
                    <span>${y(l)} / ${y(f)}</span>
                    <span style="margin-left: auto;">${r.toFixed(0)}%</span>
                </div>
                <div class="budget-progress-bar">
                    <div class="budget-progress-fill ${i}" style="width: ${r}%"></div>
                </div>
            </div>
        `}).join("")}function j(e){const t=document.getElementById("suggested-budget-container");if(!e){t.innerHTML='<p style="color: var(--color-text-secondary); text-align: center; padding: 2rem;">Upload transaction data to see budget suggestions.</p>';return}const{nextMonth:n,suggestions:o,totalSuggested:s,monthlyIncome:a,biweeklyPaycheck:l,discretionaryIncome:f}=e,r=a>0?`
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(6, 182, 212, 0.2);">
            <div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 0.25rem;">Bi-weekly Paycheck</div>
                <div style="font-size: 1.25rem; font-weight: 700; color: var(--color-success);">${y(l)}</div>
            </div>
            <div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 0.25rem;">Monthly Income</div>
                <div style="font-size: 1.25rem; font-weight: 700; color: var(--color-success);">${y(a)}</div>
            </div>
            <div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 0.25rem;">Total Budget</div>
                <div style="font-size: 1.25rem; font-weight: 700; color: var(--color-primary);">${y(s)}</div>
            </div>
            <div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 0.25rem;">Remaining</div>
                <div style="font-size: 1.25rem; font-weight: 700; color: ${f>=0?"var(--color-success)":"var(--color-danger)"};">${y(f)}</div>
            </div>
        </div>
    `:`
        <p style="margin-top: 0.75rem;"><strong>Total Suggested Budget:</strong> ${y(s)}</p>
    `;t.innerHTML=`
        <div class="suggested-budget-info">
            <h3>Budget Plan for ${X(n)}</h3>
            <p>Based on your bi-weekly paycheck income and spending patterns. Rent is fixed, and other categories are allocated from remaining funds.</p>
            ${r}
        </div>
        <div class="suggested-budget-grid">
            ${o.map(i=>`
                <div class="suggested-budget-card">
                    <div class="suggested-budget-header">
                        <span class="suggested-budget-category">${i.category}</span>
                        <span class="suggested-budget-amount">${y(i.suggestedAmount)}</span>
                    </div>
                    <div class="suggested-budget-details">
                        <div class="suggested-budget-detail">
                            <span class="suggested-budget-detail-label">Average:</span>
                            <span class="suggested-budget-detail-value">${y(i.average)}</span>
                        </div>
                        <div class="suggested-budget-detail">
                            <span class="suggested-budget-detail-label">Range:</span>
                            <span class="suggested-budget-detail-value">${y(i.min)} - ${y(i.max)}</span>
                        </div>
                        <div class="suggested-budget-detail">
                            <span class="suggested-budget-detail-label">Months tracked:</span>
                            <span class="suggested-budget-detail-value">${i.monthsTracked}</span>
                        </div>
                    </div>
                    <p style="font-size: 0.8rem; color: var(--color-text-secondary); margin-top: 0.75rem; line-height: 1.4;">${i.reasoning}</p>
                </div>
            `).join("")}
        </div>
    `}function gt(e){const t=document.getElementById("pie-chart");if(!t)return;const n=t.getContext("2d"),o=t.width/2,s=t.height/2,a=Math.min(o,s)-40;n.clearRect(0,0,t.width,t.height);const l=e.reduce((c,[u,g])=>c+g,0);if(l===0)return;const f=["#06b6d4","#8b5cf6","#10b981","#f59e0b","#ef4444","#3b82f6","#ec4899","#14b8a6","#f97316","#84cc16","#6366f1","#a855f7"];let r=-Math.PI/2;e.forEach(([c,u],g)=>{const p=u/l*2*Math.PI,h=f[g%f.length];n.beginPath(),n.moveTo(o,s),n.arc(o,s,a,r,r+p),n.closePath(),n.fillStyle=h,n.fill(),n.strokeStyle="#0f172a",n.lineWidth=2,n.stroke();const b=r+p/2,I=a*.7,m=o+I*Math.cos(b),E=s+I*Math.sin(b),R=(u/l*100).toFixed(1);parseFloat(R)>5&&(n.fillStyle="#ffffff",n.font="bold 14px Inter",n.textAlign="center",n.textBaseline="middle",n.fillText(`${R}%`,m,E)),r+=p});const i=document.createElement("div");i.className="pie-chart-legend",i.innerHTML=e.map(([c,u],g)=>{const p=(u/l*100).toFixed(1);return`
            <div class="pie-legend-item">
                <span class="pie-legend-color" style="background-color: ${f[g%f.length]}"></span>
                <span class="pie-legend-label">${c}</span>
                <span class="pie-legend-value">${y(u)} (${p}%)</span>
            </div>
        `}).join("");const d=t.parentElement.querySelector(".pie-chart-legend");d&&d.remove(),t.parentElement.appendChild(i)}const $={transactions:[],budgets:[],insights:[]};async function pt(e,t){const n=t.filter(o=>o&&o.transaction&&typeof o.transaction.amount<"u").map(o=>({date:o.transaction.date,description:o.transaction.description,amount:o.transaction.amount,category:o.category,month:ht(o.transaction.date)}));return $.transactions.push(...n),n}async function B(e){return $.budgets.filter(t=>t.month===e)}async function ft(e,t,n){const o=$.budgets.findIndex(a=>a.category===e&&a.month===n),s={category:e,amount:t,month:n};return o>=0?$.budgets[o]=s:$.budgets.push(s),[s]}async function mt(e,t){const n=$.budgets.findIndex(o=>o.category===e&&o.month===t);n>=0&&$.budgets.splice(n,1)}async function G(e,t){$.insights=$.insights.filter(o=>o.month!==t);const n=e.map(o=>({...o,month:t}));return $.insights.push(...n),n}function ht(e){const[t,n,o]=e.split("/");return`${o}-${t.padStart(2,"0")}`}function z(e,t,n=null){const o=[],s={},a=yt(e);if(e.forEach(r=>{if(!r||!r.transaction||typeof r.transaction.amount>"u")return;const{transaction:i,category:d}=r;i.amount<0&&(s[d]||(s[d]=[]),s[d].push(Math.abs(i.amount)))}),Object.entries(s).forEach(([r,i])=>{const d=i.reduce((u,g)=>u+g,0),c=t.find(u=>u.category===r);if(c&&d>c.amount){const u=d-c.amount,g=(u/c.amount*100).toFixed(0);o.push({insight_type:"warning",category:r,message:`${r} spending exceeded budget by $${u.toFixed(2)} (${g}% over)`,amount:u})}else if(c&&d>c.amount*.8){const u=c.amount-d;o.push({insight_type:"trend",category:r,message:`${r} budget is 80% used. $${u.toFixed(2)} remaining this month`,amount:u})}}),n){const r={};n.forEach(i=>{if(!i||!i.transaction||typeof i.transaction.amount>"u")return;const{transaction:d,category:c}=i;d.amount<0&&(r[c]=(r[c]||0)+Math.abs(d.amount))}),Object.entries(s).forEach(([i,d])=>{const c=d.reduce((g,p)=>g+p,0),u=r[i]||0;if(u>0){const g=c-u,p=(g/u*100).toFixed(0);if(Math.abs(p)>30){const h=g>0?"increased":"decreased";o.push({insight_type:"trend",category:i,message:`${i} spending ${h} by ${Math.abs(p)}% vs last month`,amount:Math.abs(g)})}}})}if(a.length>0){const r=a.reduce((i,d)=>i+Math.abs(d.amount),0);o.push({insight_type:"recurring",category:"Subscriptions",message:`${a.length} recurring charges detected totaling $${r.toFixed(2)}/month`,amount:r})}const l=Object.entries(s).map(([r,i])=>({category:r,total:i.reduce((d,c)=>d+c,0)})).filter(r=>r.category!=="Income").sort((r,i)=>i.total-r.total).slice(0,3);l.length>0&&o.push({insight_type:"tip",category:l[0].category,message:`Your top spending category is ${l[0].category} at $${l[0].total.toFixed(2)}`,amount:l[0].total});const f=e.filter(r=>!r||!r.transaction||typeof r.transaction.amount>"u"?!1:r.transaction.amount<0&&Math.abs(r.transaction.amount)<10);if(f.length>5){const r=f.reduce((i,d)=>!d||!d.transaction||typeof d.transaction.amount>"u"?i:i+Math.abs(d.transaction.amount),0);o.push({insight_type:"tip",category:null,message:`${f.length} small purchases under $10 add up to $${r.toFixed(2)}. Consider bundling trips`,amount:r})}return o}function yt(e){const t=["OPENAI","NETFLIX","SPOTIFY","APPLE","MICROSOFT","BOLT","SUBSCRIPTION"],n=[];return e.forEach(o=>{if(!o||!o.transaction||!o.transaction.description||typeof o.transaction.amount>"u")return;const{transaction:s}=o,a=s.description.toUpperCase();t.some(l=>a.includes(l))&&s.amount<0&&n.push(s)}),n}function vt(e){if(!e||e.length===0)return null;const t={},n=[];e.forEach(g=>{if(!g.transactions||!Array.isArray(g.transactions))return;const p={};g.transactions.forEach(h=>{if(!h||typeof h.amount>"u")return;const b=h.category||"Uncategorized",I=parseFloat(h.amount);if(!isNaN(I)){if(b==="Income"){n.push(Math.abs(I));return}b!=="Transfers"&&(p[b]||(p[b]=0),p[b]+=Math.abs(I))}}),Object.keys(p).forEach(h=>{t[h]||(t[h]=[]),t[h].push(p[h])})});const s=V(n)||0,a=s*2;if(Object.keys(t).length===0)return null;const l=["Rent","Subscriptions"],f=["Rent","Utilities","Insurance"],r=["Entertainment","Shopping","Dining"],i=[];Object.keys(t).forEach(g=>{const p=t[g],h=l.includes(g),b=f.includes(g),I=r.includes(g),m=p.reduce((x,D)=>x+D,0)/p.length,E=Math.max(...p),R=Math.min(...p);let C,A,S;if(g==="Food")C=1e3,A="Fixed monthly food budget.",S=1;else if(h){const x=V(p);x&&Math.abs(x-m)/m<.15?(C=x,A="Recurring bill at consistent amount."):(C=m,A="Fixed expense based on average."),S=1}else if(b)C=m,A="Essential expense based on average.",S=2;else if(I)C=m*.9,A="Discretionary spending - reduced to stay within budget.",S=4;else{const x=p.reduce((nt,ot)=>nt+Math.pow(ot-m,2),0)/p.length;Math.sqrt(x)/m>.3?(C=m*1.05,A="Variable spending with small buffer.",S=3):(C=m,A="Based on average spending.",S=3)}i.push({category:g,suggestedAmount:Math.ceil(C/10)*10,average:Math.round(m),min:Math.round(R),max:Math.round(E),monthsTracked:p.length,reasoning:A,priority:S})}),i.sort((g,p)=>g.priority!==p.priority?g.priority-p.priority:p.suggestedAmount-g.suggestedAmount);let d=i.reduce((g,p)=>g+p.suggestedAmount,0);if(d>a*.95){const g=a*.95,p=i.filter(m=>m.priority<=2).reduce((m,E)=>m+E.suggestedAmount,0),h=g-p,b=i.filter(m=>m.priority>2),I=b.reduce((m,E)=>m+E.suggestedAmount,0);if(I>0){const m=h/I;b.forEach(E=>{E.suggestedAmount=Math.ceil(E.suggestedAmount*m/10)*10,E.reasoning="Adjusted to ensure budget stays within income."})}d=i.reduce((m,E)=>m+E.suggestedAmount,0)}const c=a-d;return{nextMonth:bt(e[e.length-1].month),suggestions:i,totalSuggested:d,monthlyIncome:Math.round(a),biweeklyPaycheck:Math.round(s),discretionaryIncome:Math.round(c)}}function V(e){if(!e||e.length===0)return null;const t=5,n=[];return e.forEach(o=>{let s=!1;for(let a of n)if(Math.abs(a.center-o)<=t){a.amounts.push(o),a.center=a.amounts.reduce((l,f)=>l+f,0)/a.amounts.length,s=!0;break}s||n.push({center:o,amounts:[o]})}),n.sort((o,s)=>s.amounts.length-o.amounts.length),n.length>0&&n[0].amounts.length>=2?Math.round(n[0].center):null}function bt(e){const[t,n]=e.split("-").map(Number),o=new Date(t,n-1);o.setMonth(o.getMonth()+1);const s=o.getFullYear(),a=String(o.getMonth()+1).padStart(2,"0");return`${s}-${a}`}let L=[],T=null,v=[],M=null,w=[];const q=document.getElementById("file-input"),Et=document.getElementById("upload-btn"),Tt=document.getElementById("upload-section"),It=document.getElementById("report-section"),Mt=document.getElementById("add-budget-btn"),J=document.getElementById("budget-modal"),Z=document.getElementById("budget-form"),Q=document.getElementById("budget-month-selector");Et.addEventListener("click",()=>{q.click()});document.querySelector(".upload-box").addEventListener("dragover",e=>{e.preventDefault(),e.currentTarget.classList.add("dragover")});document.querySelector(".upload-box").addEventListener("dragleave",e=>{e.currentTarget.classList.remove("dragover")});document.querySelector(".upload-box").addEventListener("drop",e=>{e.preventDefault(),e.currentTarget.classList.remove("dragover");const t=e.dataTransfer.files;t.length>0&&tt(t[0])});q.addEventListener("change",e=>{e.target.files.length>0&&tt(e.target.files[0])});Mt.addEventListener("click",()=>{At()});Z.addEventListener("submit",async e=>{e.preventDefault(),await St()});Q.addEventListener("change",async e=>{const t=e.target.value;t?(M=t,await Ct(t)):await O()});async function tt(e){try{const t=await e.text();if(console.log("File loaded, parsing CSV..."),L=st(t),console.log("Parsed transactions:",L.length),console.log("Sample parsed transaction:",L[0]),L.length===0){alert("No valid transactions found in the CSV file. Please check the format.");return}if(T=it(L),console.log("Categorized transactions:",T.length),console.log("Sample categorized item:",T[0]),T.length===0){alert("No valid categorized transactions. Please check the CSV format.");return}if(v=lt(T),console.log("Monthly data groups:",v.length),v.length===0){alert("No valid monthly data generated. Please check the CSV format.");return}const n=v.map(o=>o.month);M=n[n.length-1],await pt(L,T),await O(),Tt.style.display="none",It.style.display="block"}catch(t){console.error("Error processing file:",t),console.error("Error stack:",t.stack),alert(`Error processing CSV file: ${t.message}
Please check the browser console for details.`)}}async function O(){if(v.length>0){dt(v);const e=[];for(const o of v){const s=await B(o.month),a=z(o.transactions,s);await G(a,o.month),e.push(...a)}H(e),$t();const t=vt(v);j(t),w=await B(M);const n=v.find(o=>o.month===M);n&&N(w,n.summary.categoryTotals)}else{const e=k(T);w=await B(M);const t=z(T,w);await G(t,M),Y(e,T),H(t),N(w,e.categoryTotals),j(null)}}function $t(){if(v.length>0){const e=v.map(t=>t.month);Q.innerHTML='<option value="">All Months</option>'+e.map(t=>`<option value="${t}" ${t===M?"selected":""}>${Lt(t)}</option>`).join("")}}async function Ct(e){const t=await B(e),n=v.find(o=>o.month===e);n&&N(t,n.summary.categoryTotals)}function At(){const e=document.getElementById("budget-category");let t=[];if(v.length>0){const n=v.find(o=>o.month===M);n&&(t=n.summary.categoryTotals)}else t=k(T).categoryTotals;e.innerHTML='<option value="">Select a category</option>'+t.filter(([n])=>n!=="Income"&&n!=="Transfers").map(([n])=>`<option value="${n}">${n}</option>`).join(""),J.style.display="flex"}window.closeBudgetModal=function(){J.style.display="none",Z.reset()};async function St(){const e=document.getElementById("budget-category").value,t=parseFloat(document.getElementById("budget-amount").value);if(!(!e||!t))try{await ft(e,t,M),await O(),window.closeBudgetModal()}catch(n){console.error("Error saving budget:",n),alert("Error saving budget. Please try again.")}}window.deleteBudgetItem=async function(e){if(confirm(`Delete budget for ${e}?`))try{await mt(e,M),await O()}catch(t){console.error("Error deleting budget:",t),alert("Error deleting budget. Please try again.")}};const F=document.getElementById("search-input"),P=document.getElementById("category-filter");F&&F.addEventListener("input",U);P&&P.addEventListener("change",U);function U(){if(!T)return;const e=F.value.toLowerCase(),t=P.value,n=T.filter(o=>{const s=o.transaction.description.toLowerCase().includes(e)||o.transaction.date.includes(e),a=!t||o.category===t;return s&&a});et(n)}function et(e){const t=document.getElementById("transactions-body");t.innerHTML=e.map(n=>{const o=n.transaction.amount<0,s=o?"negative":"positive",a=o?"-":"+",l=Math.abs(n.transaction.amount);return`
            <tr>
                <td>${n.transaction.date}</td>
                <td class="description">${n.transaction.description}</td>
                <td><span class="category-badge ${xt(n.category)}">${n.category}</span></td>
                <td class="text-right ${s}">${a}$${l.toFixed(2)}</td>
            </tr>
        `}).join("")}function xt(e){return{Income:"cat-income",Rent:"cat-rent",Food:"cat-food",Utilities:"cat-utilities","Auto & Gas":"cat-auto",Subscriptions:"cat-subscriptions",Transfers:"cat-transfers",Shopping:"cat-shopping",Entertainment:"cat-entertainment",Charity:"cat-charity",Uncategorized:"cat-uncategorized"}[e]||"cat-default"}function Lt(e){const[t,n]=e.split("-");return new Date(t,parseInt(n)-1).toLocaleDateString("en-US",{year:"numeric",month:"long"})}window.filterTransactions=U;window.renderTransactionTable=et;
